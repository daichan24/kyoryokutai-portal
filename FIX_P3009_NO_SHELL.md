# P3009 エラー解決（Render 無料版・シェル不可）

## 問題

- Render の無料版ではシェル機能が使えない
- P3009 エラー: 失敗したマイグレーションが残っているため、新しいマイグレーションが適用できない

## 解決方法: 新しいマイグレーションを作成

失敗したマイグレーションをスキップし、修正版を新しいマイグレーションとして作成します。

### ステップ1: 新しいマイグレーションを作成

新しいマイグレーション `20260120000000_fix_snspost_week_format_v2` を作成しました。

このマイグレーションは:
- 既に適用されている部分はスキップ（冪等性確保）
- エラーが発生しても続行可能（EXCEPTION ハンドリング）
- 失敗したマイグレーションとは独立して実行可能

### ステップ2: コードをプッシュ

```bash
git add .
git commit -m "fix: SNSPost.week 修正を新しいマイグレーションとして追加（v2）"
git push origin main
```

### ステップ3: Render で自動デプロイ

Render で自動的に新しいマイグレーションが実行されます。

**注意**: 失敗したマイグレーション `20260119000000_fix_snspost_week_format` はスキップされ、新しいマイグレーション `20260120000000_fix_snspost_week_format_v2` が適用されます。

### ステップ4: デプロイ後の確認

Render のログで以下を確認:

```
RUN MIGRATE
Applying migration `20260120000000_fix_snspost_week_format_v2`
✅ すべての week が "YYYY-WWW" 形式に変換されました
MIGRATE DONE
```

## 失敗したマイグレーションの処理

失敗したマイグレーション `20260119000000_fix_snspost_week_format` は、以下のいずれかの状態です:

1. **全く適用されていない**: 新しいマイグレーションがすべてを処理
2. **部分的に適用されている**: 新しいマイグレーションが残りの部分を処理（冪等性により安全）

## 期待される結果

- ✅ 新しいマイグレーションが正常に適用される
- ✅ すべての week が "YYYY-WWW" 形式になる
- ✅ API が正常に動作する（P2032 エラーが解消）

## 注意事項

- 新しいマイグレーションは冪等性を確保しているため、何度実行しても安全です
- 失敗したマイグレーションはそのまま残りますが、新しいマイグレーションが処理するため問題ありません
- 将来的に、失敗したマイグレーションを手動で「適用済み」としてマークすることも可能です（その場合は Render の有料版が必要）

